{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>Warning</p> <p>This project is in early development and is not production-ready. Use at your own risk.</p>"},{"location":"#cardano-node-test-assets-for-antithesis","title":"Cardano Node test assets for Antithesis","text":"<p>This repository contains test assets and configurations for running Antithesis tests against Cardano Node implementations.</p>"},{"location":"#structure-of-the-repository","title":"Structure of the repository","text":"<ul> <li><code>testnets/</code>: Contains configurations for various Cardano test networks.</li> <li><code>components/</code>: Contains reusable components for setting up test environments.</li> </ul>"},{"location":"#components","title":"Components","text":"<p>These are docker containers useful to set up the test environment for Antithesis. Dependign on their role, they can be simple wrappers around external executables as well as complex services that we think can be useful in an active or passive way to test Cardano Nodes.</p> <ul> <li><code>adversary/</code>: A Node 2 Node client that behave maliciously to test the robustness of Cardano Node implementations.</li> <li><code>configurator/</code>: A component that generates configuration files for Cardano Node instances based on test requirements.</li> <li><code>config/</code>: A special components that let antithesis be configured via a container.</li> <li><code>sidecar/</code>: A set of tests that Antithesis is performing to validate the network status.</li> <li><code>tracer/</code>: A component that collects and analyzes trace logs from Cardano Node instances during tests.</li> <li><code>tracer-sidecar/</code>: A sidecar service that runs alongside</li> </ul>"},{"location":"#testnets","title":"Testnets","text":"<p>Currently we provide and maintain only one testnet configuration, but we plan to expand this list in the future. Some old famoud testnets are broken in the old-broken directory for historical reference link</p> <ul> <li><code>cardano-node-master/</code>: A testnet that runs the latest Cardano Node from the latest published image. It's made of 5 producer nodes, a tracer, a tracer-sidecar and a sidecar. The testnet is configured to run with the latest Cardano Node version and is used to validate the basic functionality of Antithesis. You can find the configuration files in the testnets/cardano-node-master directory.</li> </ul>"},{"location":"contributing/","title":"Contributing","text":""},{"location":"contributing/#docs","title":"Docs","text":"<p>We use mkdocs to build the documentation site. To preview the docs locally.</p>"},{"location":"contributing/#nix","title":"Nix","text":"<pre><code>nix develop -c mkdocs serve\n</code></pre>"},{"location":"contributing/#without-nix","title":"Without Nix","text":"<pre><code>pip install mkdocs mkdocs-material mkdocs-asciinema-plugin mkdocs-callouts-plugin\nmkdocs serve\n</code></pre>"},{"location":"components/adversary/","title":"Adversarial node for Cardano-Antithesis","text":"<p>The idea is to create an executable which:</p> <ul> <li>can be triggered by Antithesis</li> <li>behaves like a node but with unusual (possible adversarial) behaviours</li> <li>in order to test the \"real\" nodes in the cluster run by Antithesis</li> </ul> <p>Cardano protocol details:</p> <ul> <li>Node to node protocol (we act like a node)</li> <li> <p>Specifically chain sync mini-protocol (p.21 of Network-spec), peer   propagation protocol.</p> </li> <li> <p>As a downstream peer:</p> </li> <li>Unsual behaviours:<ul> <li>ask to sync to random intersection points (for example, blocks that might have been rolled back)</li> <li>multiple random connect/follow/disconnect (maybe use Antithesis for randomness?)</li> </ul> </li> <li>As an upstream peer:</li> <li>serve incorrect headers/blocks/chains.</li> </ul> <p>Overall approach:</p> <ol> <li>Using tracer sidecar, get all intersection points from logs of nodes in cluster</li> <li>Write these chain points into a file on disk</li> <li>Adversarial node reads this file selects random points</li> <li>Provide a command (to let Antithesis decide when to use it)</li> <li>When command is called, select random point from file and do a chain sync</li> </ol> <p>Implementation considerations:</p> <ul> <li>Make a Haskell executable</li> <li>Not absurd to start from scratch but can look at cardano-wallet code for inspiration</li> <li>Must have ouroboros-network (and possibly ouroboros-consensus-cardano) as dependencies</li> <li>Might need external C libraries (libsodium)</li> <li>All this might make it necessary to use Nix to get all dependencies working</li> </ul>"},{"location":"components/adversary/#issue","title":"Issue","text":"<p>To be controlled by antithesis we have to create an idling container with scripts at the special directory <code>/opt/antithesis/test/v1</code></p> <p>To test it we have to exec into the container and run the script <code>parallel_driver_flaky_chain_sync.sh</code> located at <code>/opt/antithesis/test/v1/chain-sync-client/</code></p> <p>The scripts is located in the composer directory of this adversary component.</p>"},{"location":"components/adversary/#build-the-image","title":"Build the image","text":""},{"location":"components/adversary/#nix","title":"Nix","text":"<ol> <li>Install Nix package manager from https://nixos.org/download.html</li> <li>Connect to the Cachix cache for faster builds     <code>bash     nix shell nixpkgs#cachix -c cachix use paolino</code></li> <li>Build the image     <code>bash     nix build .#docker-image     version=$(nix eval --raw .#version)     docker load &lt; ./result</code></li> </ol>"},{"location":"components/adversary/#non-nix","title":"Non-nix","text":"<p>There is a Dockerfile available 1. Build the image     <code>bash     version=$(cat ./version)     docker build -t ghcr.io/cardano-foundation/cardano-node-antithesis/adversary:dev -f ./Dockerfile .</code></p>"},{"location":"components/adversary/#run-the-test-script","title":"Run the test script","text":"<ol> <li>Change the image tag in the compose to <code>dev</code> <code>bash     test=../../testnets/cardano_node_master/docker-compose.yml     sed -i 's|ghcr.io/cardano-foundation/cardano-node-antithesis/adversary:.*|ghcr.io/cardano-foundation/cardano-node-antithesis/adversary:dev|' $test</code></li> <li>Start the testnet     <code>bash     docker compose -f $test up -d</code></li> <li>Exec into the adversary container     <code>bash     docker compose -f $test exec adversary /bash</code></li> <li>Run the script     <code>bash     /opt/antithesis/test/v1/chain-sync-client/parallel_driver_flaky_chain_sync.sh</code></li> </ol>"},{"location":"components/adversary/#see-also","title":"See Also","text":"<ul> <li>link(s) to more detailed project documents</li> <li>License: see LICENSE</li> <li>Contributing: see CONTRIBUTING.md</li> <li>Security: see SECURITY.md</li> <li>Other projects by HAL</li> <li>Other projects by the Cardano Foundation</li> <li>About Cardano</li> </ul>"},{"location":"components/config/","title":"Config","text":""},{"location":"components/configurator/","title":"Configurator","text":""},{"location":"components/sidecar/","title":"Sidecar","text":""},{"location":"components/tracer-sidecar/","title":"Tracer-sidecar","text":""},{"location":"components/tracer/","title":"Tracer","text":""},{"location":"testnets/","title":"Testnets","text":""},{"location":"testnets/#just-commands","title":"Just commands","text":"<pre><code>just\n</code></pre> <pre><code>Available recipes:\n    attack testnet='cardano_node_master'            # attack the network with adversarial chain sync clients\n    check-convergence testnet='cardano_node_master' # check convergence of nodes in a testnet\n    default                                         # just this help message\n    exec container testnet='cardano_node_master'    # exec into a container\n    format                                          # format code\n    logs container testnet='cardano_node_master'    # view logs of a container\n    ps testnet='cardano_node_master'                # list containers in a testnet\n    restart testnet='cardano_node_master'           # restart a testnet\n    start testnet='cardano_node_master'             # start a testnet\n    stats testnet='cardano_node_master'             # view resource usage stats of a testnet\n    stop testnet='cardano_node_master'              # stop a testnet\n</code></pre>"},{"location":"testnets/#command-to-start-the-testnet","title":"Command to start the testnet","text":"<p>It's possible and desirable to run the testnet locally, before submitting them to Antithesis. Nevertheless we have to do some gymnic to actually try the scripts in the sidecar.</p> <p>The <code>justfile</code> contains a command to start the testnet, just some wrappers around docker-compose, which means that all the images are available locally or on public repositories.</p>"},{"location":"testnets/cardano-node-master/","title":"Cardano Node Master","text":"<p>A 5 pools testnet using cardano-node latest image from ghcr.io/IntersectMBO/cardano-node:latest</p>"},{"location":"testnets/cardano-node-master/#overview","title":"Overview","text":"<p>This testnet is designed to run the latest Cardano Node from the latest published image. It consists of 5 producer nodes, a tracer, a tracer-sidecar, and a sidecar. The testnet is configured to run with the latest Cardano Node version and is used to validate the basic functionality of Antithesis.</p>"}]}